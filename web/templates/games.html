{% extends "base.html" %}

{% block title %}Game Library - LLM Chess Benchmark{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-nav">
        <a href="/leaderboard" class="page-nav-link">Leaderboard</a>
        <h1 class="active">Games</h1>
    </div>
    <p class="subtitle">{{ filtered_games|length }} games{% if model_filter %} featuring {{ model_filter|e }}{% endif %}</p>
</div>

<div class="filters">
    <select id="model-filter" class="filter-select">
        <option value="">All Models</option>
    </select>
</div>

<div class="games-container">
    <table class="games-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>White</th>
                <th>Black</th>
                <th>Result</th>
                <th>Termination</th>
                <th>Moves</th>
                <th>Illegal</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="games-tbody">
            {% for game in filtered_games %}
            <tr data-white="{{ game.white|e }}" data-black="{{ game.black|e }}" data-winner="{{ game.winner|e }}">
                <td class="date">{{ game.created_at[:10] if game.created_at else 'N/A' }}</td>
                <td class="player white {% if game.winner == 'white' %}winner{% elif game.winner == 'black' %}loser{% endif %}">{{ game.white }}</td>
                <td class="player black {% if game.winner == 'black' %}winner{% elif game.winner == 'white' %}loser{% endif %}">{{ game.black }}</td>
                <td class="result">
                    {% if game.winner == 'white' %}
                    1-0
                    {% elif game.winner == 'black' %}
                    0-1
                    {% else %}
                    ½-½
                    {% endif %}
                </td>
                <td class="termination">{{ game.termination }}</td>
                <td class="moves">{{ game.moves }}</td>
                <td class="illegal" title="White: {{ game.illegal_moves_white|default(0) }}, Black: {{ game.illegal_moves_black|default(0) }}">
                    {{ (game.illegal_moves_white|default(0)) + (game.illegal_moves_black|default(0)) }}
                </td>
                <td class="view">
                    <a href="/game/{{ game.game_id }}" class="view-btn">View</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if not filtered_games %}
<div class="empty-state">
    <p>No games found{% if model_filter %} for {{ model_filter|e }}{% endif %}.</p>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const modelFilter = document.getElementById('model-filter');

    // Populate dropdown with models from server
    const allModels = {{ all_models|tojson }};
    const currentFilter = {{ model_filter|tojson }};

    allModels.forEach(model => {
        const option = document.createElement('option');
        option.value = model;
        option.textContent = model;
        if (model === currentFilter) {
            option.selected = true;
        }
        modelFilter.appendChild(option);
    });

    modelFilter.addEventListener('change', function() {
        const selectedModel = modelFilter.value;
        if (selectedModel) {
            window.location.href = '/games?model=' + encodeURIComponent(selectedModel);
        } else {
            window.location.href = '/games';
        }
    });
});
</script>
{% endblock %}
