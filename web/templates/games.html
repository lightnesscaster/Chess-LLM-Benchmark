{% extends "base.html" %}

{% block title %}Game Library - LLM Chess Benchmark{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Game Library</h1>
    <p class="subtitle">{{ games|length }} games played</p>
</div>

<div class="filters">
    <input type="text" id="search" placeholder="Filter by player name..." class="search-input">
    <select id="result-filter" class="filter-select">
        <option value="">All Results</option>
        <option value="white">White Wins</option>
        <option value="black">Black Wins</option>
        <option value="draw">Draws</option>
    </select>
</div>

<div class="games-container">
    <table class="games-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>White</th>
                <th>Black</th>
                <th>Result</th>
                <th>Termination</th>
                <th>Moves</th>
                <th>Illegal</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="games-tbody">
            {% for game in games %}
            <tr data-white="{{ game.white }}" data-black="{{ game.black }}" data-winner="{{ game.winner }}">
                <td class="date">{{ game.created_at[:10] if game.created_at else 'N/A' }}</td>
                <td class="player white {% if game.winner == 'white' %}winner{% endif %}">{{ game.white }}</td>
                <td class="player black {% if game.winner == 'black' %}winner{% endif %}">{{ game.black }}</td>
                <td class="result">
                    {% if game.winner == 'white' %}
                    1-0
                    {% elif game.winner == 'black' %}
                    0-1
                    {% else %}
                    ½-½
                    {% endif %}
                </td>
                <td class="termination">{{ game.termination }}</td>
                <td class="moves">{{ game.moves }}</td>
                <td class="illegal" title="White: {{ game.illegal_moves_white|default(0) }}, Black: {{ game.illegal_moves_black|default(0) }}">
                    {{ (game.illegal_moves_white|default(0)) + (game.illegal_moves_black|default(0)) }}
                </td>
                <td class="view">
                    <a href="/game/{{ game.game_id }}" class="view-btn">View</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if not games %}
<div class="empty-state">
    <p>No games recorded yet.</p>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search');
    const resultFilter = document.getElementById('result-filter');
    const tbody = document.getElementById('games-tbody');

    function filterGames() {
        const searchTerm = searchInput.value.toLowerCase();
        const resultValue = resultFilter.value;
        const rows = tbody.querySelectorAll('tr');

        rows.forEach(row => {
            const white = row.dataset.white.toLowerCase();
            const black = row.dataset.black.toLowerCase();
            const winner = row.dataset.winner;

            const matchesSearch = !searchTerm || white.includes(searchTerm) || black.includes(searchTerm);
            const matchesResult = !resultValue || winner === resultValue;

            row.style.display = matchesSearch && matchesResult ? '' : 'none';
        });
    }

    searchInput.addEventListener('input', filterGames);
    resultFilter.addEventListener('change', filterGames);
});
</script>
{% endblock %}
