{% extends "base.html" %}

{% block title %}Game Library - LLM Chess Benchmark{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Game Library</h1>
    <p class="subtitle">{{ games|length }} games played</p>
</div>

<div class="filters">
    <select id="model-filter" class="filter-select">
        <option value="">All Models</option>
    </select>
</div>

<div class="games-container">
    <table class="games-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>White</th>
                <th>Black</th>
                <th>Result</th>
                <th>Termination</th>
                <th>Moves</th>
                <th>Illegal</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="games-tbody">
            {% for game in games %}
            <tr data-white="{{ game.white }}" data-black="{{ game.black }}" data-winner="{{ game.winner }}">
                <td class="date">{{ game.created_at[:10] if game.created_at else 'N/A' }}</td>
                <td class="player white {% if game.winner == 'white' %}winner{% elif game.winner == 'black' %}loser{% endif %}">{{ game.white }}</td>
                <td class="player black {% if game.winner == 'black' %}winner{% elif game.winner == 'white' %}loser{% endif %}">{{ game.black }}</td>
                <td class="result">
                    {% if game.winner == 'white' %}
                    1-0
                    {% elif game.winner == 'black' %}
                    0-1
                    {% else %}
                    ½-½
                    {% endif %}
                </td>
                <td class="termination">{{ game.termination }}</td>
                <td class="moves">{{ game.moves }}</td>
                <td class="illegal" title="White: {{ game.illegal_moves_white|default(0) }}, Black: {{ game.illegal_moves_black|default(0) }}">
                    {{ (game.illegal_moves_white|default(0)) + (game.illegal_moves_black|default(0)) }}
                </td>
                <td class="view">
                    <a href="/game/{{ game.game_id }}" class="view-btn">View</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if not games %}
<div class="empty-state">
    <p>No games recorded yet.</p>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const modelFilter = document.getElementById('model-filter');
    const tbody = document.getElementById('games-tbody');
    const rows = tbody.querySelectorAll('tr');

    // Collect unique models from all games
    const models = new Set();
    rows.forEach(row => {
        models.add(row.dataset.white);
        models.add(row.dataset.black);
    });

    // Populate dropdown with sorted models
    Array.from(models).sort().forEach(model => {
        const option = document.createElement('option');
        option.value = model;
        option.textContent = model;
        modelFilter.appendChild(option);
    });

    // Check for model parameter in URL and pre-select
    const urlParams = new URLSearchParams(window.location.search);
    const modelParam = urlParams.get('model');
    if (modelParam && models.has(modelParam)) {
        modelFilter.value = modelParam;
    }

    function filterGames() {
        const selectedModel = modelFilter.value;

        rows.forEach(row => {
            const white = row.dataset.white;
            const black = row.dataset.black;

            const matchesModel = !selectedModel || white === selectedModel || black === selectedModel;

            row.style.display = matchesModel ? '' : 'none';
        });
    }

    modelFilter.addEventListener('change', filterGames);

    // Apply filter on page load if model param exists
    if (modelParam) {
        filterGames();
    }
});
</script>
{% endblock %}
