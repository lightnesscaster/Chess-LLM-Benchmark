{% extends "base.html" %}

{% block title %}Leaderboard - LLM Chess Benchmark{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-nav">
        <h1 class="active">Leaderboard</h1>
        <a href="/games" class="page-nav-link">Games</a>
        <a href="/methodology" class="page-nav-link">Methodology</a>
    </div>
    <p class="subtitle">LLMs ranked by Lichess Classical rating, estimated from real results using Glicko-2 and engine anchors</p>
</div>

{% if leaderboard %}
<div class="leaderboard-container">
    <table class="leaderboard-table">
        <thead>
            <tr>
                <th class="rank">#</th>
                <th class="player">Player</th>
                <th class="rating">Rating</th>
                <th class="fide">FIDE Est.</th>
                <th class="rd">RD</th>
                <th class="ci">95% CI</th>
                <th class="games">Games</th>
                <th class="record">W-L-D</th>
                <th class="legal">Legal%</th>
                <th class="cost">$/Game</th>
            </tr>
        </thead>
        <tbody>
            {% set ns = namespace(top_llm_found=false) %}
            {% for entry in leaderboard %}
            {% set is_top_llm = not entry.is_anchor and not ns.top_llm_found %}
            {% if is_top_llm %}{% set ns.top_llm_found = true %}{% endif %}
            <tr class="{% if entry.is_anchor %}anchor{% elif is_top_llm %}top-llm{% endif %} clickable-row" data-player-id="{{ entry.player_id|e }}">
                <td class="rank">{{ entry.rank }}</td>
                <td class="player">
                    {{ entry.player_id }}
                    {% if entry.is_anchor %}<span class="anchor-badge" title="Anchor (fixed rating)">*</span>{% endif %}
                    {% if is_top_llm %}<span class="crown-badge" title="Top-rated LLM">ðŸ‘‘</span>{% endif %}
                </td>
                <td class="rating">{{ entry.rating }}</td>
                <td class="fide">{% if entry.fide_estimate is not none %}~{{ entry.fide_estimate }}{% else %}N/A{% endif %}</td>
                <td class="rd">{% if entry.is_anchor %}N/A{% else %}{{ entry.rating_deviation }}{% endif %}</td>
                <td class="ci">{% if entry.is_anchor %}N/A{% else %}{{ entry.confidence_low }} - {{ entry.confidence_high }}{% endif %}</td>
                <td class="games">{{ entry.games_played }}</td>
                <td class="record">{{ entry.wins|default(0) }}-{{ entry.losses|default(0) }}-{{ entry.draws|default(0) }}</td>
                <td class="legal">{{ "%.1f"|format((entry.legal_move_rate|default(1.0)) * 100) }}%</td>
                <td class="cost">{% if entry.avg_cost_per_game is not none %}${{ "%.4f"|format(entry.avg_cost_per_game) }}{% else %}-{% endif %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="legend">
    <p>ðŸ‘‘ = Top-rated LLM</p>
    <p><strong style="color: var(--accent)">*</strong> = Anchor player (fixed rating, used for calibration)</p>
    <p><strong>FIDE Est.</strong> = Estimated FIDE rating based on <a href="https://chessgoals.com/rating-comparison/" target="_blank">ChessGoals.com</a> survey data</p>
    <p><strong>RD</strong> = Rating Deviation (uncertainty in rating)</p>
    <p><strong>95% CI</strong> = 95% Confidence Interval</p>
    <p><strong>Legal%</strong> = Percentage of moves that were legal on first attempt</p>
    <p><strong>$/Game</strong> = Average cost per game based on OpenRouter pricing</p>
</div>
{% else %}
<div class="empty-state">
    <p>No players in the leaderboard yet. Run some benchmark games to populate ratings.</p>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const rows = document.querySelectorAll('.clickable-row');
    rows.forEach(row => {
        row.addEventListener('click', function() {
            const playerId = this.dataset.playerId;
            window.location.href = '/games?model=' + encodeURIComponent(playerId);
        });
    });
});
</script>
{% endblock %}
